const questions = {
  "general": {
    "easy": [
      {
        "question": "What is the capital of France?",
        "options": [
          "Paris",
          "Berlin",
          "Madrid",
          "Rome"
        ],
        "answer": "Paris"
      },
      {
        "question": "How many continents are there?",
        "options": [
          "5",
          "6",
          "7",
          "8"
        ],
        "answer": "7"
      },
      {
        "question": "Which color is a banana?",
        "options": [
          "Blue",
          "Red",
          "Yellow",
          "Green"
        ],
        "answer": "Yellow"
      },
      {
        "question": "What is 2+2?",
        "options": [
          "3",
          "4",
          "5",
          "6"
        ],
        "answer": "4"
      },
      {
        "question": "Which day comes after Friday?",
        "options": [
          "Sunday",
          "Monday",
          "Saturday",
          "Thursday"
        ],
        "answer": "Saturday"
      }
    ],
    "medium": [
      {
        "question": "What year did World War II end?",
        "options": [
          "1945",
          "1939",
          "1918",
          "1965"
        ],
        "answer": "1945"
      },
      {
        "question": "Who painted the Mona Lisa?",
        "options": [
          "Van Gogh",
          "Michelangelo",
          "Da Vinci",
          "Picasso"
        ],
        "answer": "Da Vinci"
      },
      {
        "question": "What is the capital of Canada?",
        "options": [
          "Toronto",
          "Ottawa",
          "Vancouver",
          "Montreal"
        ],
        "answer": "Ottawa"
      },
      {
        "question": "Who discovered penicillin?",
        "options": [
          "Pasteur",
          "Einstein",
          "Fleming",
          "Curie"
        ],
        "answer": "Fleming"
      },
      {
        "question": "What is the square root of 81?",
        "options": [
          "8",
          "9",
          "10",
          "7"
        ],
        "answer": "9"
      }
    ],
    "hard": [
      {
        "question": "In what year was the United Nations founded?",
        "options": [
          "1945",
          "1950",
          "1939",
          "1960"
        ],
        "answer": "1945"
      },
      {
        "question": "What is the atomic number of Oxygen?",
        "options": [
          "6",
          "7",
          "8",
          "9"
        ],
        "answer": "8"
      },
      {
        "question": "Who was the first president of the USA?",
        "options": [
          "Jefferson",
          "Lincoln",
          "Washington",
          "Adams"
        ],
        "answer": "Washington"
      },
      {
        "question": "Which element has the symbol 'Au'?",
        "options": [
          "Silver",
          "Argon",
          "Gold",
          "Aluminium"
        ],
        "answer": "Gold"
      }
    ]
  },
  "science": {
    "easy": [
      {
        "question": "Water's chemical formula is?",
        "options": [
          "CO2",
          "O2",
          "H2O",
          "NaCl"
        ],
        "answer": "H2O"
      },
      {
        "question": "What planet is known as the Red Planet?",
        "options": [
          "Earth",
          "Mars",
          "Jupiter",
          "Venus"
        ],
        "answer": "Mars"
      },
      {
        "question": "Which organ pumps blood?",
        "options": [
          "Liver",
          "Lungs",
          "Heart",
          "Brain"
        ],
        "answer": "Heart"
      },
      {
        "question": "Humans breathe in which gas?",
        "options": [
          "Oxygen",
          "Carbon Dioxide",
          "Hydrogen",
          "Nitrogen"
        ],
        "answer": "Oxygen"
      },
      {
        "question": "How many legs do insects have?",
        "options": [
          "4",
          "6",
          "8",
          "10"
        ],
        "answer": "6"
      }
    ],
    "medium": [
      {
        "question": "What gas do plants absorb?",
        "options": [
          "Oxygen",
          "Carbon Dioxide",
          "Hydrogen",
          "Nitrogen"
        ],
        "answer": "Carbon Dioxide"
      },
      {
        "question": "Speed of light is approximately?",
        "options": [
          "300,000 km/s",
          "150,000 km/s",
          "1,000 km/s",
          "500,000 km/s"
        ],
        "answer": "300,000 km/s"
      },
      {
        "question": "What planet is closest to the sun?",
        "options": [
          "Venus",
          "Mars",
          "Mercury",
          "Earth"
        ],
        "answer": "Mercury"
      },
      {
        "question": "What is the boiling point of water in \u00b0C?",
        "options": [
          "80",
          "90",
          "100",
          "110"
        ],
        "answer": "100"
      },
      {
        "question": "What part of the cell contains DNA?",
        "options": [
          "Cytoplasm",
          "Nucleus",
          "Wall",
          "Membrane"
        ],
        "answer": "Nucleus"
      }
    ],
    "hard": [
      {
        "question": "Which particle has no charge?",
        "options": [
          "Proton",
          "Electron",
          "Neutron",
          "Photon"
        ],
        "answer": "Neutron"
      },
      {
        "question": "What is Newton's third law?",
        "options": [
          "Inertia",
          "Force=ma",
          "Action-Reaction",
          "Gravity"
        ],
        "answer": "Action-Reaction"
      },
      {
        "question": "What is the chemical symbol for Iron?",
        "options": [
          "Fe",
          "Ir",
          "In",
          "I"
        ],
        "answer": "Fe"
      },
      {
        "question": "What type of bond is in water?",
        "options": [
          "Ionic",
          "Hydrogen",
          "Covalent",
          "Metallic"
        ],
        "answer": "Covalent"
      }
    ]
  },
  "sports": {
    "easy": [
      {
        "question": "How many players in a football team?",
        "options": [
          "9",
          "10",
          "11",
          "12"
        ],
        "answer": "11"
      },
      {
        "question": "Which country won FIFA 2022?",
        "options": [
          "France",
          "Germany",
          "Brazil",
          "Argentina"
        ],
        "answer": "Argentina"
      },
      {
        "question": "How many holes in a full round of golf?",
        "options": [
          "9",
          "18",
          "12",
          "15"
        ],
        "answer": "18"
      },
      {
        "question": "Which sport uses a bat and ball?",
        "options": [
          "Football",
          "Cricket",
          "Tennis",
          "Swimming"
        ],
        "answer": "Cricket"
      },
      {
        "question": "In which sport do you shoot arrows?",
        "options": [
          "Shooting",
          "Archery",
          "Darts",
          "Golf"
        ],
        "answer": "Archery"
      }
    ],
    "medium": [
      {
        "question": "How many rings on the Olympic flag?",
        "options": [
          "4",
          "5",
          "6",
          "7"
        ],
        "answer": "5"
      },
      {
        "question": "Which sport is associated with Wimbledon?",
        "options": [
          "Cricket",
          "Tennis",
          "Golf",
          "Rugby"
        ],
        "answer": "Tennis"
      },
      {
        "question": "Where are the Olympics held every 4 years?",
        "options": [
          "Same country",
          "Rotating countries",
          "Only Europe",
          "USA"
        ],
        "answer": "Rotating countries"
      },
      {
        "question": "Which country hosted the 2016 Olympics?",
        "options": [
          "USA",
          "UK",
          "Brazil",
          "Japan"
        ],
        "answer": "Brazil"
      },
      {
        "question": "How long is a marathon?",
        "options": [
          "21km",
          "26.2 miles",
          "10km",
          "42.2 miles"
        ],
        "answer": "26.2 miles"
      }
    ],
    "hard": [
      {
        "question": "In which sport is the Davis Cup awarded?",
        "options": [
          "Tennis",
          "Golf",
          "Baseball",
          "Football"
        ],
        "answer": "Tennis"
      },
      {
        "question": "Who has won most Grand Slam titles (men's)?",
        "options": [
          "Nadal",
          "Federer",
          "Djokovic",
          "Sampras"
        ],
        "answer": "Djokovic"
      },
      {
        "question": "Which country has most World Cup wins?",
        "options": [
          "Germany",
          "Italy",
          "Brazil",
          "Argentina"
        ],
        "answer": "Brazil"
      },
      {
        "question": "How many players in a volleyball team?",
        "options": [
          "5",
          "6",
          "7",
          "8"
        ],
        "answer": "6"
      }
    ]
  }
};

let currentQuestion = 0;
let score = 0;
let selectedCategory = "";
let selectedDifficulty = "";
let shuffledQuestions = [];
let timer;
let timeLeft = 15;
let userName = "";
let userAnswers = [];

const startScreen = document.getElementById("start-screen");
const quizBox = document.getElementById("quiz-box");
const resultBox = document.getElementById("result-box");
const reviewBox = document.getElementById("review-box");
const questionText = document.getElementById("question-text");
const optionList = document.getElementById("option-list");
const nextBtn = document.getElementById("next-btn");
const timerDisplay = document.getElementById("timer");
const scoreText = document.getElementById("score-text");
const highscoreText = document.getElementById("highscore-text");
const progress = document.getElementById("progress");

function startQuiz() {
  userName = document.getElementById("username").value.trim();
  selectedCategory = document.getElementById("category").value;
  selectedDifficulty = document.getElementById("difficulty").value;
  if (!userName || !selectedCategory || !selectedDifficulty) {
    alert("Please enter your name, category and difficulty.");
    return;
  }

  currentQuestion = 0;
  score = 0;
  userAnswers = [];

  const allQs = questions[selectedCategory][selectedDifficulty];
  shuffledQuestions = shuffleArray([...allQs]);
  shuffledQuestions.forEach(q => q.options = shuffleArray([...q.options]));

  startScreen.classList.add("hidden");
  quizBox.classList.remove("hidden");
  quizBox.classList.add("show");

  showQuestion();
  updateProgress();
  startTimer();
}

function showQuestion() {
  resetState();
  updateProgress();
  const question = shuffledQuestions[currentQuestion];
  questionText.textContent = question.question;

  question.options.forEach(option => {
    const li = document.createElement("li");
    li.textContent = option;
    li.onclick = () => selectOption(li, question.answer);
    optionList.appendChild(li);
  });
}

function selectOption(selected, correctAnswer) {
  clearInterval(timer);
  const options = optionList.querySelectorAll("li");
  options.forEach(option => {
    option.onclick = null;
    if (option.textContent === correctAnswer) {
      option.classList.add("correct");
    } else {
      option.classList.add("wrong");
    }
  });

  const userAnswer = selected.textContent;
  userAnswers.push({
    question: shuffledQuestions[currentQuestion].question,
    selected: userAnswer,
    correct: correctAnswer
  });

  if (userAnswer === correctAnswer) score++;
  nextBtn.classList.remove("hidden");
}

function nextQuestion() {
  currentQuestion++;
  if (currentQuestion < shuffledQuestions.length) {
    showQuestion();
    startTimer();
  } else {
    showResult();
  }
}

function showResult() {
  quizBox.classList.add("hidden");
  resultBox.classList.remove("hidden");
  resultBox.classList.add("show");

  const total = shuffledQuestions.length;
  scoreText.textContent = `${userName}, you scored ${score} out of ${total} (${Math.round(score / total * 100)}%)`;

  const highKey = `highscore_${selectedCategory}_${selectedDifficulty}`;
  const prev = JSON.parse(localStorage.getItem(highKey)) || { name: "", score: 0 };

  if (score > prev.score) {
    localStorage.setItem(highKey, JSON.stringify({ name: userName, score }));
    highscoreText.textContent = `🎉 New High Score!`;
  } else {
    highscoreText.textContent = `🏆 High Score: ${prev.name} - ${prev.score}`;
  }

  saveToLeaderboard(`${selectedCategory}_${selectedDifficulty}`, userName, score);
  updateLeaderboard(`${selectedCategory}_${selectedDifficulty}`);
  showReview();
}

function showReview() {
  resultBox.classList.add("hidden");
  reviewBox.classList.remove("hidden");
  reviewBox.classList.add("show");

  const reviewList = document.getElementById("review-list");
  reviewList.innerHTML = "";

  userAnswers.forEach((item, index) => {
    const li = document.createElement("li");
    li.innerHTML = `
      <strong>Q${index + 1}:</strong> ${item.question}<br>
      <span style="color:${item.selected === item.correct ? 'green' : 'red'}">
        Your answer: ${item.selected}
      </span><br>
      <span>Correct answer: ${item.correct}</span>
    `;
    reviewList.appendChild(li);
  });
}

function restartQuiz() {
  reviewBox.classList.add("hidden");
  resultBox.classList.add("hidden");
  startScreen.classList.remove("hidden");
}

function resetState() {
  optionList.innerHTML = "";
  nextBtn.classList.add("hidden");
  timeLeft = 15;
  timerDisplay.textContent = timeLeft;
}

function startTimer() {
  timer = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = timeLeft;
    if (timeLeft === 0) {
      clearInterval(timer);
      autoReveal();
    }
  }, 1000);
}

function autoReveal() {
  const q = shuffledQuestions[currentQuestion];
  const options = optionList.querySelectorAll("li");
  options.forEach(option => {
    option.onclick = null;
    if (option.textContent === q.answer) {
      option.classList.add("correct");
    } else {
      option.classList.add("wrong");
    }
  });

  userAnswers.push({
    question: q.question,
    selected: "⏱ No answer",
    correct: q.answer
  });

  nextBtn.classList.remove("hidden");
}

function updateProgress() {
  const total = shuffledQuestions.length;
  const percent = ((currentQuestion + 1) / total) * 100;
  progress.style.width = percent + "%";
}

function shuffleArray(array) {
  return array.sort(() => Math.random() - 0.5);
}

// 🌙 Dark mode toggle
const darkToggle = document.getElementById("dark-mode-toggle");
if (localStorage.getItem("darkMode") === "enabled") {
  document.body.classList.add("dark-mode");
  darkToggle.checked = true;
}
darkToggle.addEventListener("change", () => {
  if (darkToggle.checked) {
    document.body.classList.add("dark-mode");
    localStorage.setItem("darkMode", "enabled");
  } else {
    document.body.classList.remove("dark-mode");
    localStorage.setItem("darkMode", "disabled");
  }
});

// 🏆 Leaderboard
function updateLeaderboard(categoryKey) {
  const key = `leaderboard_${categoryKey}`;
  const leaderboard = JSON.parse(localStorage.getItem(key)) || [];
  leaderboard.sort((a, b) => b.score - a.score);

  const list = document.getElementById("leaderboard-list");
  list.innerHTML = "";

  leaderboard.slice(0, 3).forEach((entry, index) => {
    const li = document.createElement("li");
    li.textContent = `${index + 1}. ${entry.name} - ${entry.score}`;
    list.appendChild(li);
  });

  document.getElementById("leaderboard").classList.remove("hidden");
}

function saveToLeaderboard(categoryKey, name, score) {
  const key = `leaderboard_${categoryKey}`;
  const leaderboard = JSON.parse(localStorage.getItem(key)) || [];
  leaderboard.push({ name, score });
  localStorage.setItem(key, JSON.stringify(leaderboard));
}

// Splash screen logic
window.onload = () => {
  setTimeout(() => {
    document.getElementById("splash-screen").style.display = "none";
  }, 3000);
};
